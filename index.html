<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Registration Form - 5th District Level Yogasana Sports Championship</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      background: #f4f6fa;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0; padding: 0;
    }
    .form-container {
      background: #fff;
      max-width: 780px;
      margin: 32px auto 24px auto;
      border-radius: 12px;
      box-shadow: 0 4px 18px rgba(96, 113, 148, 0.1);
      padding: 0 0 40px 0;
      box-sizing: border-box;
    }
    .banner-img {
      display: block;
      width: 100%;
      max-width: 520px;
      margin: 24px auto 0 auto;
      border-radius: 9px;
      box-shadow: 0 2px 10px rgba(128, 128, 128, 0.07);
      background: #fff;
    }
    .form-head {
      text-align: center;
      padding: 0 32px;
      margin-top: 24px;
    }
    .title-main {
      color: #1d3a79;
      font-size: 1.55em;
      font-weight: bold;
      margin-bottom: 6px;
    }
    .desc {
      color: #374160;
      font-size: 1.05em;
      margin-bottom: 25px;
      line-height: 1.5;
    }
    .note {
      color: #963512;
      background: #fff3e5;
      font-weight: 600;
      border-left: 3.5px solid #ff9800;
      padding: 10px 16px;
      margin: 0 24px 22px 24px;
      border-radius: 7px;
      font-size: 0.99em;
    }
    hr {
      margin: 30px 0;
      border: none;
      border-top: 1.5px solid #e1e6ec;
      max-width: 680px;
      margin-left: auto;
      margin-right: auto;
    }
    .form-section {
      padding: 0 38px;
      max-width: 680px;
      margin: 0 auto 26px auto;
      box-sizing: border-box;
    }
    .form-section h2 {
      color: #215da6;
      font-size: 1.14em;
      font-weight: bold;
      margin-bottom: 12px;
      margin-top: 25px;
    }
    label {
      font-weight: 600;
      display: block;
      margin: 12px 0 5px 0;
      color: #153769;
      cursor: pointer;
    }
    input, select, textarea {
      width: 100%;
      padding: 11px 12px;
      border: 1.5px solid #dde3ee;
      border-radius: 7px;
      font-size: 1em;
      background: #f4f8fc;
      color: #183153;
      margin-bottom: 7px;
      transition: border-color 0.15s;
      box-sizing: border-box;
      box-sizing: border-box;
    }
    input[type='file'] {
      background: transparent;
      border: none;
      margin-bottom: 18px;
      padding: 0;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #3065d8;
      outline: none;
    }
    .event-options {
      margin-bottom: 7px;
    }
    .event-options span {
      display: inline-block;
      margin-right: 16px;
      cursor: pointer;
      user-select: none;
    }
    .event-options input[type=checkbox] {
      margin-right: 6px;
      width: 20px;
      height: 20px;
    }
    .submit-btn {
      font-weight: 600;
      margin-top: 18px;
      background: #174ea6;
      color: #fff;
      padding: 16px 34px;
      font-size: 1.13em;
      border: none;
      border-radius: 7px;
      cursor: pointer;
      letter-spacing: 0.02em;
      box-shadow: 0 2px 8px rgba(20, 64, 131, 0.11);
      display: block;
      margin-left: auto;
      margin-right: auto;
      transition: background 0.16s;
    }
    .submit-btn:hover {
      background: #0e387a;
    }
    .small {
      font-size: 0.95em;
      color: #636880;
      margin-bottom: 10px;
    }
    ul, li {
      font-size: 0.98em;
    }
    .player2-subsection {
      margin-left: 20px;
      border-left: 4px solid #cfe2ff;
      padding-left: 15px;
      margin-top: 12px;
    }
    .yogasana-player-info-section {
      background: #f9fafb;
      border-radius: 10px;
      padding: 30px 38px 20px 38px !important;
      box-shadow: 0 2px 10px rgba(200, 210, 235, 0.15);
      max-width: 680px;
      margin: 0 auto 26px auto;
      box-sizing: border-box;
      border: none !important;
      display: none; /* managed by JS */
    }
    input[readonly] {
      background: #e0e6f1;
      color: #3a4959;
    }
    @media (max-width: 600px) {
      .form-container, .form-section, .yogasana-player-info-section {
        width: 95%;
        padding: 0 15px;
      }
      .event-options span {
        display: block;
        margin-bottom: 6px;
      }
    }
  </style>
</head>
<body>
  <div class="form-container">
    <img class="banner-img" src="image.jpg" alt="Yogasana Championship Banner" />
    <div class="form-head">
      <div class="title-main">
        Registration Form for 5th District Level Yogasana Sports Championship, North West Delhi
      </div>
      <div class="desc">
        <b>Date:</b> August 24, 2025<br/>
        <b>Reporting Time:</b> 8:00 AM onwards<br/>
        <b>Venue:</b> Sirifort Institute of Management Studies,<br/>
        Plot Number 8, Institutional Area, Sector 25, Rohini, Delhi-110085.<br/>
        <b>Landmark:</b> Near ISKCON Rohini<br/>
        <b>Location on Map:</b> 
        <a href="https://maps.app.goo.gl/iJ71X8rkMTNf2HD96" target="_blank" style="color:#2f5bc1">View Map</a><br/>
        <b>Nearest Metro:</b> Rithala (Red Line)
      </div>
    </div>
    <div class="note">
      This Championship is for North West District Residents only. Others need NOC from their district.
    </div>
    <form id="yogasana-form" novalidate>
      <div class="form-section">
        <h2>Personal Details</h2>

        <label for="email">Email <span style="color:#d72a1a">*</span></label>
        <input id="email" name="email" type="email" required />

        <label for="member_referral">YI Member Referral (Name &amp; Contact No. of DYSA/YI Member) <span style="color:#d72a1a">*</span></label>
        <input id="member_referral" name="member_referral" type="text" required placeholder="Name and Contact Number" />

        <label for="institution_name">Name of School/College/Institution/Organization (or 'Self') <span style="color:#d72a1a">*</span></label>
        <input id="institution_name" name="institution_name" type="text" required placeholder="e.g., XYZ School or Self" />

        <label for="institution_address">Address of School/College/Institution/Organization <span style="color:#d72a1a">*</span></label>
        <textarea id="institution_address" name="institution_address" rows="3" required placeholder="Full Address"></textarea>

        <label for="institution_contact">Contact No. of School/College/Institution/Organization <span style="color:#d72a1a">*</span></label>
        <input id="institution_contact" name="institution_contact" type="text" required placeholder="+91-xxxxxxxxxx"/>

        <label for="district">Select District <span style="color:#d72a1a">*</span></label>
        <select id="district" name="district" required>
          <option value="" disabled selected>Select</option>
          <option>North West Delhi</option>
          <option>North Delhi</option>
          <option>North East Delhi</option>
          <option>East Delhi</option>
          <option>New Delhi</option>
          <option>Shahdara</option>
          <option>South Delhi</option>
          <option>South East Delhi</option>
          <option>South West Delhi</option>
          <option>West Delhi</option>
          <option>Central Delhi</option>
          <option>Other</option>
        </select>
        <div class="small">If not North West, NOC is required.</div>

        <label for="age_category">Age Category (as on 1 Jan 2025) <span style="color:#d72a1a">*</span></label>
        <select id="age_category" name="age_category" required>
          <option value="" disabled selected>Select</option>
          <option>Sub Junior (10+ to 14 years)</option>
          <option>Junior (14+ to 18 Years)</option>
          <option>Senior (18+ to 28 Years)</option>
          <option>Masters - A (28+ to 35 Years)</option>
          <option>Masters - B (35+ to 45 Years)</option>
          <option>Masters - C (45+ to 55 Years)</option>
        </select>

        <label for="gender">Player Gender <span style="color:#d72a1a">*</span></label>
        <select id="gender" name="gender" required>
          <option value="" disabled selected>Select</option>
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>

        <label>Events (Max two) <span style="color:#d72a1a">*</span></label>
        <div class="event-options">
          <span><input type="checkbox" name="events" value="Traditional Yogasana" id="event_trad" /><label for="event_trad">Traditional Yogasana</label></span>
          <span><input type="checkbox" name="events" value="Artistic Single" id="event_art_single" /><label for="event_art_single">Artistic Single</label></span>
          <span><input type="checkbox" name="events" value="Rhythmic Pair" id="event_rhythmic"/><label for="event_rhythmic">Rhythmic Pair</label></span>
          <span><input type="checkbox" name="events" value="Artistic Pair" id="event_art_pair"/><label for="event_art_pair">Artistic Pair</label></span>
        </div>
        <div class="small">Select maximum two events.</div>
      </div>

      <hr />

      <!-- New Yogasana Player Information Section -->
      <div class="form-section yogasana-player-info-section">
        <h2>Yogasana Player Information</h2>
        <label>Description (optional)</label>
        <input name="yogasana_desc" type="text" />
        <label>Player Name <span style="color:#d72a1a">*</span></label>
        <input name="yogasana_p1_name" type="text" />
        <label>Father's Name <span style="color:#d72a1a">*</span></label>
        <input name="yogasana_p1_father" type="text" />
        <label>Date of Birth <span style="color:#d72a1a">*</span></label>
        <input name="yogasana_p1_dob" type="date" />
        <label>Age (as on 1 Jan 2025) <span style="color:#d72a1a">*</span></label>
        <input name="yogasana_p1_age" type="number" min="10" max="55" readonly />
        <label>Mobile/WhatsApp Number <span style="color:#d72a1a">*</span></label>
        <input name="yogasana_p1_mobile" type="text" />

        <div class="player2-subsection">
          <h3>Player 2 Information</h3>
          <label>Player Name</label>
          <input name="yogasana_p2_name" type="text" />
          <label>Father's Name</label>
          <input name="yogasana_p2_father" type="text" />
          <label>Date of Birth</label>
          <input name="yogasana_p2_dob" type="date" />
          <label>Age (as on 1 Jan 2025)</label>
          <input name="yogasana_p2_age" type="number" min="10" max="55" readonly />
          <label>Mobile/WhatsApp Number</label>
          <input name="yogasana_p2_mobile" type="text" />
        </div>
      </div>

      <hr />

      <!-- Traditional Yogasana Player Info -->
      <div class="form-section traditional-yogasana-section">
        <h2>Traditional Yogasana Player Information</h2>
        <label>Description (optional)</label>
        <input name="trad_yoga_desc" type="text" />
        <label>Player Name <span style="color:#d72a1a">*</span></label>
        <input name="trad_yoga_name" type="text" />
        <label>Father's Name <span style="color:#d72a1a">*</span></label>
        <input name="trad_yoga_father" type="text" />
        <label>Date of Birth <span style="color:#d72a1a">*</span></label>
        <input name="trad_yoga_dob" type="date" />
        <label>Age (as on 1 Jan 2025) <span style="color:#d72a1a">*</span></label>
        <input name="trad_yoga_age" type="number" min="10" max="55" readonly />
        <label>Mobile/WhatsApp Number <span style="color:#d72a1a">*</span></label>
        <input name="trad_yoga_mobile" type="text" />
      </div>

      <hr />

      <!-- Artistic Yogasana Player Info -->
      <div class="form-section artistic-yogasana-section">
        <h2>Artistic Yogasana Player Information</h2>
        <label>Description (optional)</label>
        <input name="artistic_yoga_desc" type="text" />
        <label>Player Name</label>
        <input name="artistic_yoga_name" type="text" />
        <label>Father's Name</label>
        <input name="artistic_yoga_father" type="text" />
        <label>Date of Birth</label>
        <input name="artistic_yoga_dob" type="date" />
        <label>Age (as on 1 Jan 2025)</label>
        <input name="artistic_yoga_age" type="number" min="10" max="55" readonly />
        <label>Mobile/WhatsApp Number</label>
        <input name="artistic_yoga_mobile" type="text" />
      </div>

      <hr />

      <!-- Rhythmic Pair Yogasana Info -->
      <div class="form-section rhythmic-pair-section">
        <h2>Rhythmic Pair Yogasana Players Information</h2>
        <label>Description (optional)</label>
        <input name="rp_desc" type="text" />
        <div class="small" style="margin-top: 0; margin-bottom: 7px; font-weight: 600;">Player 1</div>
        <label>Name</label>
        <input name="rp_p1_name" type="text" />
        <label>Father's Name</label>
        <input name="rp_p1_father" type="text" />
        <label>Date of Birth</label>
        <input name="rp_p1_dob" type="date" />
        <label>Age (as on 1 Jan 2025)</label>
        <input name="rp_p1_age" type="number" min="10" max="55" readonly />
        <label>Mobile/WhatsApp Number</label>
        <input name="rp_p1_mobile" type="text" />
        <label>Email ID</label>
        <input name="rp_p1_email" type="email" />
        <div class="small" style="margin-top: 19px; margin-bottom: 7px; font-weight: 600;">Player 2</div>
        <label>Name</label>
        <input name="rp_p2_name" type="text" />
        <label>Father's Name</label>
        <input name="rp_p2_father" type="text" />
        <label>Date of Birth</label>
        <input name="rp_p2_dob" type="date" />
        <label>Age (as on 1 Jan 2025)</label>
        <input name="rp_p2_age" type="number" min="10" max="55" readonly />
        <label>Mobile/WhatsApp Number</label>
        <input name="rp_p2_mobile" type="text" />
        <label>Email ID</label>
        <input name="rp_p2_email" type="email" />
      </div>

      <hr />

      <!-- Artistic Pair Yogasana Info -->
      <div class="form-section artistic-pair-section">
        <h2>Artistic Pair Players Information</h2>
        <label>Description (optional)</label>
        <input name="ap_desc" type="text" />
        <div class="small" style="margin-top: 0; margin-bottom: 7px; font-weight: 600;">Player 1</div>
        <label>Name</label>
        <input name="ap_p1_name" type="text" />
        <label>Father's Name</label>
        <input name="ap_p1_father" type="text" />
        <label>Date of Birth</label>
        <input name="ap_p1_dob" type="date" />
        <label>Age (as on 1 Jan 2025)</label>
        <input name="ap_p1_age" type="number" min="10" max="55" readonly />
        <label>Mobile/WhatsApp Number</label>
        <input name="ap_p1_mobile" type="text" />
        <label>Email ID</label>
        <input name="ap_p1_email" type="email" />
        <div class="small" style="margin-top: 19px; margin-bottom: 7px; font-weight: 600;">Player 2</div>
        <label>Name</label>
        <input name="ap_p2_name" type="text" />
        <label>Father's Name</label>
        <input name="ap_p2_father" type="text" />
        <label>Date of Birth</label>
        <input name="ap_p2_dob" type="date" />
        <label>Age (as on 1 Jan 2025)</label>
        <input name="ap_p2_age" type="number" min="10" max="55" readonly />
        <label>Mobile/WhatsApp Number</label>
        <input name="ap_p2_mobile" type="text" />
        <label>Email ID</label>
        <input name="ap_p2_email" type="email" />
      </div>

      <hr />

      <div class="form-section">
        <h2>Fee & Document Submission</h2>
        <div class="small">
          <b>Account Details (for UPI/Bank transfer):</b> Vansh Kaushik, 1345362679,
          IFSC KKBK0000197, Kotak Mahindra Bank, Rohini Delhi
        </div>
        <label>UPI QR Code for Payment (upload image)</label>
        <input type="file" accept="image/*" />
        <label>Upload Passport Size Photo (collage for group) <span style="color:#d72a1a">*</span></label>
        <input type="file" name="photo" accept="image/*" required />
        <label>Upload Birth Certificate <span style="color:#d72a1a">*</span></label>
        <input type="file" name="birth_cert" accept="image/*,application/pdf" required />
        <label>Aadhar Card Front Photo <span style="color:#d72a1a">*</span></label>
        <input type="file" name="aadhar_front" accept="image/*" required />
        <label>Aadhar Card Back Photo <span style="color:#d72a1a">*</span></label>
        <input type="file" name="aadhar_back" accept="image/*" required />
        <label>Payment Transaction ID <span style="color:#d72a1a">*</span></label>
        <input type="text" name="txn_id" required />
        <label>Upload Payment Receipt <span style="color:#d72a1a">*</span></label>
        <input type="file" name="payment_receipt" accept="image/*,application/pdf" required />
      </div>

      <hr />

      <button type="submit" class="submit-btn">Submit Registration</button>
    </form>
  </div>

  <script>
    // Limit max 2 checkboxes in Events section
    const eventCheckboxes = document.querySelectorAll('input[name="events"]');
    eventCheckboxes.forEach(cb => {
      cb.addEventListener('change', (e) => {
        const checkedBoxes = [...eventCheckboxes].filter(i => i.checked);
        if (checkedBoxes.length > 2) {
          e.target.checked = false;
          alert('You can select maximum 2 events.');
        }
      });
    });

    // Helper to calculate age from DOB
    function calculateAge(dobStr) {
      if (!dobStr) return '';
      const dob = new Date(dobStr);
      const refDate = new Date('2025-01-01T00:00:00');
      let age = refDate.getFullYear() - dob.getFullYear();
      const m = refDate.getMonth() - dob.getMonth();
      if (m < 0 || (m === 0 && refDate.getDate() < dob.getDate())) {
        age--;
      }
      return age >= 0 ? age : '';
    }

    // On DOB change, update connected age fields
    ['yogasana_p1_dob', 'yogasana_p2_dob', 'trad_yoga_dob', 'artistic_yoga_dob', 'rp_p1_dob', 'rp_p2_dob', 'ap_p1_dob', 'ap_p2_dob'].forEach(dobName => {
      const dobInput = document.querySelector(`input[name="${dobName}"]`);
      if (dobInput) {
        dobInput.addEventListener('change', () =>{
          const ageName = dobName.replace('_dob', '_age');
          const ageInput = document.querySelector(`input[name="${ageName}"]`);
          if (ageInput) ageInput.value = calculateAge(dobInput.value);
        });
      }
    });

    // Synchronize Rhythmic Pair Player 1 info to Artistic Pair Player 1 inputs (read-only)
    function syncRpP1ToApP1() {
      const rpP1Fields = ['name', 'father', 'dob', 'mobile', 'email'];
      rpP1Fields.forEach(field => {
        const rpInput = document.querySelector(`input[name="rp_p1_${field}"]`);
        const apInput = document.querySelector(`input[name="ap_p1_${field}"]`);
        if (rpInput && apInput) {
          apInput.value = rpInput.value;
          apInput.readOnly = true;
        }
      });
      // Age is readonly and synced manually
      const rpDobInput = document.querySelector('input[name="rp_p1_dob"]');
      const apAgeInput = document.querySelector('input[name="ap_p1_age"]');
      if(rpDobInput && apAgeInput){
        apAgeInput.value = calculateAge(rpDobInput.value);
        apAgeInput.readOnly = true;
      }
    }

    // Enable or disable artistic pair player1 readonly based on sync status
    function updateSyncApP1Readonly(enableReadonly) {
      const apP1Fields = ['name', 'father', 'dob', 'mobile', 'email'];
      apP1Fields.forEach(field => {
        const apInput = document.querySelector(`input[name="ap_p1_${field}"]`);
        if (apInput) apInput.readOnly = enableReadonly;
      });
      const apAgeInput = document.querySelector('input[name="ap_p1_age"]');
      if (apAgeInput) apAgeInput.readOnly = true;
    }

    // Show/hide player 2 info block on Yogasana Player Information
    const yogPlayer2Div = document.querySelector('.yogasana-player-info-section .player2-subsection');

    // Implement your updateSections logic here if needed (omitted for brevity)

    // Form submission handler with file upload and SheetDB POST
    document.getElementById('yogasana-form').addEventListener('submit', async function(e){
      e.preventDefault();
      const form = e.target;
      const data = {};
      const fileFields = ['photo', 'birth_cert', 'aadhar_front', 'aadhar_back', 'payment_receipt'];
      let fileUrls = {};

      // Helper to read file as base64
      function readFileAsBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result.split(',')[1]);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      // Upload each file and get Drive links
      for(const field of fileFields){
        const input = form.elements[field];
        if(input && input.files.length){
          try {
            const file = input.files[0];
            const base64 = await readFileAsBase64(file);
            const GAS_URL = 'https://script.google.com/macros/s/AKfycbwnqvsXZv6Ov6I2_NujkvvMqe4KNk7BJ0vMcvNLwkxfYTMpfh1rJVl9ueoRcRqCaMD4AQ/exec'; // Replace with your Apps Script URL
            const payload = new URLSearchParams();
            payload.append('file_data', base64);
            payload.append('file_name', file.name);
            payload.append('file_type', file.type);
            let response = await fetch(GAS_URL, {method: 'POST', body: payload});
            let driveUrl = await response.text();
            fileUrls[field] = driveUrl;
          } catch (error) {
            alert(`Failed to upload ${field}. Try again.`);
            return;
          }
        }
      }

      // Collect other form inputs (excluding files and submit button)
      Array.from(form.elements).forEach(input => {
        if (input.name && input.type !== 'file' && input.type !== 'submit' && !(input.name in fileUrls)) {
          if (input.type === 'checkbox') {
            if (input.checked) {
              if (data[input.name]) data[input.name] += ', ' + input.value;
              else data[input.name] = input.value;
            }
          } else {
            data[input.name] = input.value;
          }
        }
      });

      // Insert file URL fields
      Object.assign(data, fileUrls);

      // Post data to SheetDB
      const SHEETDB_URL = 'https://sheetdb.io/api/v1/5etutih450ztw'; // Replace with your SheetDB URL
      try {
        const resp = await fetch(SHEETDB_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ data })
        });
        if (resp.ok) {
          alert('Registration successful!');
          form.reset();
        } else {
          alert('Error submitting form! Please try again.');
        }
      } catch (err) {
        alert('Network error! Please try again.');
      }
    });
  </script>
</body>
</html>
